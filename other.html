<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>其他页 - 大聪明战队</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            padding-top: calc(var(--title-height) + var(--nav-height));
        }

        .main-title {
            font-size: clamp(2rem, 8vw, 8rem);
            font-family: "华文行楷", STXingKai, serif;
            text-align: center;
            margin: 0;
            padding: 0.5rem 0;
            background-color: #fff;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        nav {
            background-color: #000;
            padding: 0.3rem 0; /* 减小内边距 */
            text-align: center;
            position: fixed;
            top: var(--title-height);
            left: 0;
            right: 0;
            z-index: 99;
            white-space: nowrap;
            overflow: hidden;
        }

        nav a {
            color: #fff;
            font-size: clamp(0.8rem, 3vw, 1.8rem); /* 减小字体大小 */
            font-weight: bold;
            margin: 0 clamp(0.3rem, 2vw, 2rem); /* 减小间距 */
            text-decoration: none;
            padding: 0.3rem 0.8rem; /* 减小内边距 */
            border-radius: 8px;
            display: inline-block;
        }

        nav a.active {
            background-color: #ff0000;
        }

        .other-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: SimSun, 宋体, serif;
        }

        .other-section {
            margin-bottom: 30px;
        }

        .other-section h3 {
            font-size: 25px;
            margin: 15px 0;
        }

        .other-section p {
            font-size: 16px;
            line-height: 1.8;
            margin-left: 20px;
        }

        /* 留言板样式 */
        .message-board {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }

        .message-input textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            font-family: SimSun, 宋体, serif;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            margin-bottom: 10px;
        }

        .message-input button {
            background-color: #fff;
            color: #000;
            border: 1px solid #000;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        .message-input button:hover {
            background-color: #f0f0f0;
        }

        .message-list {
            margin-top: 30px;
        }

        .message-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 15px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
        }

        .delete-btn {
            color: #ff0000;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 0 5px;
        }

        .delete-btn:hover {
            text-decoration: underline;
        }

        .message-content {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .reply-section {
            margin-left: 30px;
            margin-top: 10px;
        }

        .reply-item {
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .reply-input {
            display: flex;
            margin-top: 10px;
        }

        .reply-input input {
            flex: 1;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
        }

        .reply-input button {
            background-color: #666;
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1 class="main-title">大聪明战队（粑粑战队）</h1>

    <nav>
        <a href="index.html">首页</a>
        <a href="download.html">下载</a>
        <a href="other.html" class="active">其他</a>
    </nav>

    <div class="other-content">
        <div class="other-section">
            <h3>联系我们</h3>
            <p>如有疑问或建议，可留言。</p>
            <p>新成员申请通道持续开放，详情可咨询留言。</p>
        </div>

        <div class="message-board">
            <h3>留言板</h3>
            
            <div class="message-input">
                <textarea placeholder="请输入您的留言（最多5行）..." id="messageText"></textarea>
                <button onclick="submitMessage()">提交评论</button>
            </div>

            <div class="message-list" id="messageList"></div>
        </div>
    </div>

    <script>
        // 动态计算标题和导航栏高度
        function updateHeights() {
            const title = document.querySelector('.main-title');
            const nav = document.querySelector('nav');
            document.documentElement.style.setProperty('--title-height', `${title.offsetHeight}px`);
            document.documentElement.style.setProperty('--nav-height', `${nav.offsetHeight}px`);
        }
        
        // 页面加载和窗口大小改变时更新高度
        window.onload = function() {
            updateHeights();
            fetchMessages(); // 原有的留言板加载函数
        };
        
        window.onresize = updateHeights;

        // 后端API地址（已匹配后端接口）
        const API_URL = 'http://127.0.0.1:5000';

        // 获取所有评论（接口路径：/comments）
        async function fetchMessages() {
            try {
                const response = await fetch(`${API_URL}/comments`);
                const comments = await response.json();
                renderComments(comments);
            } catch (error) {
                console.error('获取评论失败:', error);
                document.getElementById('messageList').innerHTML = 
                    '<p style="color:red; text-align:center;">无法连接到服务器，请检查后端是否运行</p>';
            }
        }

        // 提交新评论（接口路径：/comments）
        async function submitMessage() {
            const content = document.getElementById('messageText').value.trim();
            if (!content) {
                alert('请输入评论内容');
                return;
            }

            try {
                await fetch(`${API_URL}/comments`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                document.getElementById('messageText').value = '';
                fetchMessages();
            } catch (error) {
                console.error('提交评论失败:', error);
                alert('提交失败，请检查后端是否运行');
            }
        }

        // 回复评论（接口路径：/comments/ID/replies）
        async function submitReply(commentId) {
            const content = document.getElementById(`replyInput-${commentId}`).value.trim();
            if (!content) {
                alert('请输入回复内容');
                return;
            }

            try {
                await fetch(`${API_URL}/comments/${commentId}/replies`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content })
                });
                document.getElementById(`replyInput-${commentId}`).value = '';
                fetchMessages();
            } catch (error) {
                console.error('提交回复失败:', error);
                alert('回复失败，请检查后端是否运行');
            }
        }

        // 删除评论（接口路径：/comments/ID）
        async function deleteComment(commentId) {
            if (!confirm('确定删除这条评论吗？')) return;

            try {
                await fetch(`${API_URL}/comments/${commentId}`, { method: 'DELETE' });
                fetchMessages();
            } catch (error) {
                console.error('删除评论失败:', error);
                alert('删除失败，请检查后端是否运行');
            }
        }

        // 渲染评论列表
        function renderComments(comments) {
            const list = document.getElementById('messageList');
            list.innerHTML = '';

            if (comments.length === 0) {
                list.innerHTML = '<p style="text-align:center; color:#999;">暂无评论，快来成为第一个评论的人吧！</p>';
                return;
            }

            comments.forEach(comment => {
                const div = document.createElement('div');
                div.className = 'message-item';
                div.innerHTML = `
                    <div class="message-header">
                        <span>评论时间：${new Date(comment.time).toLocaleString()}</span>
                        <button class="delete-btn" onclick="deleteComment(${comment.id})">删除</button>
                    </div>
                    <div class="message-content">${comment.content}</div>
                    <div class="reply-section">
                        ${comment.replies.map(reply => `
                            <div class="reply-item">
                                <div class="message-header">
                                    <span>回复时间：${new Date(reply.time).toLocaleString()}</span>
                                </div>
                                <div class="message-content">${reply.content}</div>
                            </div>
                        `).join('')}
                        <div class="reply-input">
                            <input type="text" id="replyInput-${comment.id}" placeholder="输入回复...">
                            <button onclick="submitReply(${comment.id})">回复</button>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }
    </script>
</body>
</html>